What I Talk About When I Talk About CLI tool
====

at [YAPC::Asia 2014](http://yapcasia.org/2014/talk/show/b49cc53a-027b-11e4-9357-07b16aeab6a4)


## トークメモ

- 自分がCLIツールを作るときに意識していることを話す
- webサービスの作り方はその辺に素晴らしい資料がたくさんある
    - CLIツールのつくり方の方法論を語ったものは少ないのでは
    - DevOpsツールの盛り上がり
    - 普段あまり話されない部分について
- 技術的に深い話よりもよりハイレベルな話をする
    - この下にShellscriptではやるのか，rubyか，PythonかGolangかPerlかという話がくる
    - どんな言語でも作れるアプリケーション
- Warning
    - 本トークには個人的な思想がいくつか含まれています
        - 賛同してもらえるところは適用してもらいたい
        - 賛同できない部分はビール飲みながら議論しましょう！
- 対象オーディエンス
    - とにかく何か新しいツールを作り始めたい
        - 作りたいツール，サービスが見つからない
        - webサービスより敷居は低い
            - サーバいらない，DBいらない
    - CLIツールを作りたい
    - CLIツールを既に作ってるけど，使いやすくしたい
- 他の人に使ってもらえるようなCLIツール
- 前提
    - もちろん自分だけのために，自分の生活/仕事を楽にするためにツールをつくることは素晴らしい
    - どうせ作るなら自分以外のユーザを幸せにしたい
    - 自分以外のユーザに「使ってもらえる」ツールを作るには？
    - 自分以外のユーザに「便利だ」と思われるようなツールを作るには？
- CLIツールとは？
    - Command Line Interface tool, CLI
    - Character User Interface, CUI
    - Console User Interface, CUI
    - <-> GUI
    - 例
- CLIの利点は？
    - 処理の自動化が容易である
    - ファイルに保存して何度も実行できる
    - インターフェースがGUIと比べてシンプル（ユーザの入力処理）
        - 内部状態が少ない
    - キーボードないで完結するため，手作業が容易
        - オートコンプリートなどを使えばより迅速な作業が可能
- CLIの欠点は？
    - 習得コストがある
    - 選択肢やヘルプなどを画面上に表示するのに限界がある
    - 図形的なものの操作や編集には向かない，不可能
- CLIツールのユーザとは？
    - ツールやサービスをつくるときに大事なのは，誰に向けて作るのか？ということ誰が潜在ユーザなのか？
    - 少なくとも所謂「黒い画面」を使うユーザが対象になる
        - 対象はエンジニアになる
        - 自分と同じ世界のユーザ
        - 一般向けのサービスをつくるよりも考えることは少ない，考えやすい
        - そこから，エンジニア全般なのか，Ops向けなのか，Dev向けなのか，DevOps向けなの
- 初めてのCLIツール
    - run.sh
    - CLIツールを作り上げた！
    - これは最高にクールだ．他のチームメンバー，あわよくばインターネットの向こうのユーザに使ってもらいたい！
    - じゃあどうしよう？何が必要か？
- 「良い」CLIツールとは？（from Build Awesome Command-line tool）
    - 直感的に使える
    - 使うのを助けてくれる
    - 他のツールと協調できる
    - 適切なデフォルト値を持つ，が設定できる
    - 苦痛なくインストールできる
    - 適切に落ちる
    - ユーザを喜ばせる
- UNIX哲学
- 「便利な」/「良い」CLIツールとは？
    - 直感的である
        - 他のCLIツールに慣れ親しんだ人にも違和感なく使える
            - CLIには長い歴史がある
            - つまり慣習が存在する
            - 慣習から外れない
                - e.g.,
                - ときには慣習から外れることも必要，ただ僕らが作るほとんどのツールにそれは必要ない
            - 使ったユーザに「これは正しく動いている」と感じさせる
            - UNIX哲学！
        - CLIツールになれていないひとでもすぐに使い始めることができる
        - 一つのことに集中する
        - CLIのUI/UX
            - 入力の仕方は？
            - 出力は？
            - オプション引数は自然か?
                - 長オプションの意義とは->例えばシェルスクリプトで使われるとする
                    - -dよりも--debugと書いた方がそのシェルスクリプトを読んだ人が理解できる
            - 対話処理は多すぎないか?
                - 対話処理は最後の手段！(<-やりたいのはよくわかる)
    - 適切なデフォルト値があるが，設定できる/設定しやすい
        - 何度も使われることを考慮する
        - 毎回同じことを入力させない
        - 環境変数を使う，gitconfigを使う，dotファイルを作る
            - 機械が扱いやすい，かつユーザ読みやすいフォーマットを選ぶ
                - json，YAML，DSL，hashicorp/hcl
        - 設定ファイルは1つにする！
    - 簡単にインストールできる
    - ロギング/デバッグ
        - デバック可能にする，デバックオプションを準備する
        - はじめから準備する
        - ツールに不具合が起ったときにソースを見なくても何が起ってるのか理解できるように
            - 見るべきソースの場所のあたりをつける
    - 例外処理を適切にする
        - HTTPライブラリのエラーをそのまま表示しない
            - ラップしてそのツールに見合った出力を出力する
    - 適切なドキュメントが準備されている
        - わかりやすいREADME.mdを書く        　　　　
        - README Driven Development
        - はじめからDocumentを書こう！
        - manを提供する
- これからCLIツールを作りたいひとへのいくつかのヒント(普段自分がツールを作り始めるときの方法論
    - ツールをつくるチャンス
        - このタスクを何度も実行している!
        - このタスク複雑すぎる！もっと簡単にしたい
        - このAPIクライアントなくね？
    - ツールの必要性/汎用性
        - 自分以外に使えるひとがいるだろうか？
            - 自分以外の1人以上役に立つと思えば作り始める
    - $ emacs README.md
        - ○○ができるツール
            - 1つのことに集中する！あれもこれもできるツールを構想しない        　
        - ○○という風に実行できる
            - インターフェースを定義する
                - UNIXの思想から外れるような入力方法，オプションの指定の仕方はしていないか
        - VS. 別のツール
            - やりたいことは本当はすごく沢山あってだけど大体の物は既にあるわけじゃないですか。既にある物に勝つためには優れたアイデアかあと20年続けるモチベーションのどちらかが必要だと思います。
                - http://weblog.bulknews.net/post/94753348929
                - 大抵のものは存在する
            - 全く同じものを作るならやめたほうがよい，もったいない
            - 似たようなツールがあるが，これと比べて
                - インターフェースがとてもシンプルだ
                - 速度が速い
            - 事前調査になる
    - 言語の選定
        - あらゆるプラットフォームで簡単に使えるものを提供したい
            - Golang
        - 誰でも理解できて修正できるようにしたい
            - Bash
            - わかりやすいシェルスクリプトを書く
        - Rubyistがたくさん使ってくれそう
            - ruby
    - プロトタイプをつくる
        - shellscriptを書いてみる
    - テスト環境の準備
        - CI as a Serviceの設定をする
        - coveralls.ioの設定をする
        - これらをはじめにやるか，作り終わった後にやるかでテストへのモチベーションが全く変わる
    - ツールの作成
        - デバッグオプションを作る
            - 最初から入れる，後から入れるのは本当に面倒
            - デバッグに必要な出力は作ってるときにしかわからない
            - 環境変数から取得できるようにしておく
        - Usageを書く
        - とにかく動くものをつくる
            - オプションは最低限にする
            - オプションで切り替えたいと思うもの，切り替えたいという要望がありそうなものは変数として切り出しておく
    - 配布する
        - LL
            - rubygem?
            - CPAN?
            - pip
        - Binary
            - Github release?
            - Bintray.com?
            - Drone.io?
    - 宣伝する
        - あなたのことは誰も知らない
            - Githubにソースを上げればユーザが勝手に現れると思ってる？
        - 自分のツールの宣伝に時間を使うことに躊躇しない
            - README.mdを書いた時点でこのツールは何が優れているのかはっきりしているはず
            - 自信を持ってぶっ込んでいく
        - 日本語
            - twitterに投稿する
            - hatena bookmarkに投稿する
            - 自分のブログに書く
            - Qiitaに書く
            - 勉強会で発表する
        - 英語
            - coderwallに書く
            - HackerNewsに投稿する
            - MLに投稿する
